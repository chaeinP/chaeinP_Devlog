---
title: MySQL_데이터 모델링 실습
date: '2021-11-25'
tags: ['MySQL']
draft: false
summary:
---

> [42 체크인 서비스](https://cluster.42seoul.io/checkin)를 분석하고 이를 토대로 직접 데이터 모델링을 실습한다.
> [11/25 수정]이전에 진행했던 실습은 실제로 체크인 서버를 이용하기 전에 작성했던 것이라 틀린 부분을 보완해 재실습을 진행했다.

데이터 모델링은 [이전에 학습했던 방법](https://chaeinp.vercel.app/blog/MySQL/06_%EB%8D%B0%EC%9D%B4%ED%84%B0%20%EB%AA%A8%EB%8D%B8%EB%A7%81)을 토대로 실습을 진행했다.

핵심만 요약하면 서비스의 비즈니스 룰에서 `명사` 는 entity, 즉 테이블이 될 수 있고 `동사` 는 테이블간의 관계를 설명하며, `하나의 값으로 표현 가능한 명사`는 attribute가 될 수 있다.

## 42 체크인 서비스 룰 분석

42 체크인 login page(로그인 전)

- 개포와 서초 클러스터 각각의 총 좌석 수와 현재 사용 중인 좌석 수, 운영시간을 확인할 수 있다.

  - **개포(attribute)** 와 **서초(attribute)** **클러스터(entity)** 각각의 **총 좌석 수(attribute)** 와 **현재 사용 중인 좌석 수(attribute)**, **운영시간(attribute)** 을 확인할 수 있다.

- 유저는 42OAUTH를 통해 로그인한다.

  - **유저(entity)** 42OAUTH를 통해 **로그인(attribute)** 한다.

42 체크인 main page(체크인 전)

- 유저(entity)의 상태는 카뎃(attribute) 과 관리자(attribute)로 나뉘어있다.

  - **유저(entity)** 의 상태는 **카뎃(attribute)** 과 **관리자(attribute)** 로 나뉘어있다.

- 체크인 화면에는 유저의 42닉네임과 사진이 보인다.

  - 체크인 화면에는 **유저(entity)** 의 **닉네임(attribute)** 과 **사진(attribute)** 이 보인다.

- 유저는 화면 하단에 있는 약관에 동의하고 데스크에서 받은 카드 번호를 입력하면 체크인된다.

  - **유저(entity)** 는 데스크에서 받은 **카드 번호(attribute)** 를 이용해 **각 클러스터(entity)** 와이파이 환경에서 **체크인(attribute)** 할 수 있다.

- 왼쪽 목록 버튼을 클릭하면 체크인 여부와 상관없이 마지막 체크인 시간과 함께 이전 클러스터 방문 날짜와 이용시간을 확인할 수 있다.

  - 왼쪽 **클러스터 로그(entity)** 버튼을 클릭하면 체크인 여부와 상관없이 **마지막 체크인 시간(attribute)** 과 함께 **이전 클러스터 방문 날짜(attribute)** 와 **이용시간(attribute)** 을 확인할 수 있다.

42 체크인 main page(체크인 후)

- 화면에는 유저의 42닉네임과 사진, 체크인한 카드 번호가 보인다.

  - 화면에는 **유저(entity)** 의 **42닉네임(attribute)** 과 **사진(attribute)** , **체크인한 카드 번호(attribute)** 가 보인다.

- 유저는 하단에 위치한 체크아웃 버튼을 누르면 체크아웃할 수 있다.

  - **유저(명사)** 는 데스크에서 받은 카드를 반납하고 **체크아웃(하나의 값으로 표현 가능한 명사)** 버튼을 누르면 체크아웃 할 수 있다.

## 분석 정리

1. entity(명사) 후보

   - 유저
   - 클러스터
   - 클러스터 로그(history)

2. attribute(하나의 값으로 표현 가능한 명사) 후보

   - 클러스터 장소(개포, 서초)
   - 클러스터 총 좌석수
   - 클러스터 사용중인 좌석 수
   - 운영시간
   - ~~로그인/로그아웃~~ : 42체크인은 유저 권한 여부를 OAUTH 토큰으로 구별하고 유저의 체크인 여부를 기준으로 작동하기 때문에 별도의 로그인 로그아웃 상태값이 필요없을것이라고 판단됨.
   - 카뎃/관리자
   - 닉네임
   - 사진
   - 카드 번호 `(card_no < 1000 : 개포, card_no >= 1000 : 서초)`
   - 체크인/체크아웃
   - 체크인/체크아웃시간

3. realation

   | 유저                 | 클러스터                  | 히스토리           |
   | -------------------- | ------------------------- | ------------------ |
   | 권한 (cadet / admin) | 클러스터 장소             | 체크인 timestamp   |
   | 유저네임             | 클러스터 총 좌석 수       | 체크아웃 timestamp |
   | 사진                 | 클러스터 사용중인 좌석 수 | 유저(fk)           |
   | -                    | 클러스터 운영시간         | 카드 번호          |

비즈니스 로직에 따라 정리한 후보들을 바탕으로 entity와 attribute를 정리했다. 여기서 유저 권한, 클러스터 장소등의 경우 새로운 entity로 분리해 attribute를 따로 관리할 수도 있지만 아직까지 attribute값이 두 종류밖에 되지 않고 속성값이 늘어날 가능성도 적어보여 유저와 클러스터 entity에 attribute로 두었다. 유저 entity를 따로 둔 이유는 OAUTH로 최초 로그인시 해당 유저의 닉네임과 사진을 테이블에 따로 보관하면 이후 로그인 시 또는 화면 렌더시에 매번 42API 통신을 하지 않고 DB에서 가져와 사용할 수 있지 않을까 싶어서이다. 성능 차이는 얼마나 날지 모르겠다. 유저 테이블과 히스토리는 유저 네임을 fk로 연결했다.

## ERD 생성

<iframe width="560" height="315" src='https://dbdiagram.io/embed/619f670c8c901501c0d24a83'> </iframe>

## 서버 ERD와 실습한 ERD 비교

실제 서버 스키마는 다음과 같다.
![42checkin-server-schema](/static/images/blog/42checkin_schema.png)

서버 스키마는 테이블 join으로 발생하는 성능 저하를 막기 위해 역정규화를 진행했다고 한다.
