---
title: Deploy_Docker 명령어 정리
date: '2021-09-20'
tags: ['Deploy']
draft: false
summary: 배포를 공부하고 있다면 반드시 알아야하는 Docker 사용법
---

## 도커란?

도커는 환경이 다른 서버 컴퓨터에도 개발 환경에서 돌아가던 코드가 문제없이 작동할 수 있도록 도와주는 프로그램이다. 도커가 실행되는 과정은 다음과 같다.

- 코드 작성이 완료되면(배포를 해야할 시점이 되면) 개발 폴더에 Dockerfile을 생성해 개발 환경을 코드로 작성한다.
- 이 Dockerfile을 바탕으로 빌드하면 개발한 코드와 개발 환경을 모두 묶어 이미지화시킬 수 있다.
- 이 이미지를 도커 허브 또는 회사의 특정 허브에 저장한다.
- 배포를 진행할 컴퓨터에 도커를 깔고 해당하는 허브에서 이미지를 다운 받는다.
- 이미지를 실행시켜 컨테이너화 하면 개발 환경이 다른 컴퓨터에서도 일일히 환경 설정을 해줄 필요 없이 작성한 코드가 성공적으로 돌아간다.

도커는 Linux Container라는 기술을 기반으로 하고 있다.

💡<b>Linux Container 란?</b>

> 필요한 라이브러리와 애플리케이션을 모아서 마치 별도의 서버처럼 구성한 것을 말합니다. 컨테이너를 이루는 네트워크 설정, 환경 변수 등의 시스템 자원은 각 컨테이너가 독립적으로 소유하고 있다.

작동하는 모습은 가상 머신과 비슷하지만 가상 머신은 메인 OS 위에 여러가지 OS가 돌아가고 있다면 리눅스 컨테이너는 각 컨테이너들이 메인 OS 하나를 공유하고 있다.

**Linux Container의 특징**

- 프로세스의 구획화

  - 특정 컨테이너에서 작동하는 프로세스는 기본적으로 그 컨테이너 안에서만 액세스 할 수 있다.
  - 컨테이너 안에서 실행되는 프로세스는 다른 컨테이너의 프로세스에게 영향을 줄 수 없다.

- 네트워크의 구획화

  - 기본으로 컨테이너 하나에 IP 주소가 할당되어 있다.

- 파일 시스템의 구획화
  - 컨테이너 안에서 사용되는 파일 시스템은 구획화되어 있다. 그래서 해당 컨테이너별로 명령이나 파일 등의 액세스를 제한할 수 있다.

## 주요 용어 개념

- 레지스트리(Registry)

  - 도커 이미지를 관리하는 공간
  - 특별히 다른 것을 지정하지 않는다면, 도커 허브(Docker Hub)를 기본 레지스트리로 설정
  - 레지스트리는 Docker Hub, Private Docker Hub, 회사 내부용 레지스트리 등으로 나뉠 수 있다.

- 레포지토리(Repository)

  - 레지스트리 내에 도커 이미지가 저장되는 공간
  - 이미지 이름이 사용되기도 한다.

- 태그(Tag)
  - 해당 이미지를 설명하는 버전 정보를 주로 입력
  - 특별히 다른 것을 지정하지 않는다면 latest 태그를 붙인 이미지를 가져온다.

```
docker/whalesay:latest
```

`docker`라는 유저의` whalesay` 이미지의 `latest` 최신 버전을 의미

## 명령어 정리

### 기본 명령어

- 이미지 가져오기

```
docker image pull 이미지_이름
```

- 가져온 이미지 리스트 출력

```
docker image ls
```

- 이미지를 컨테이너로 실행

```
docker container run --name 컨테이너_이름 이미지_이름
```

- 컨테이너 리스트 출력

```
docker container ps -a
```

`-a` 옵션을 붙이면 종료된 컨테이너를 포함해 모든 컨테이너 리스트를 출력한다.

- 컨테이너 삭제

```
docker container rm 컨테이너_이름
```

- 이미지 삭제

```
docker image rm 이미지_이름
docker rmi 이미지_이름
```

- 이미지 가져오고 컨테이너 실행하고 실행후 바로 삭제하기

```
docker container run --name 컨테이너_이름 --rm 이미지_이름
```

`docker conatiner run`을 실행하면 이미지 다운과 컨테이너 실행을 동시에 수행한다. 여기선 `--rm`옵션을 붙여 실행후 바로 삭제할 수 있도록 하였다.

- 사용자와 컨테이너 간 인터섹션이 필요할 때

```
docker container run -it --rm danielkraic/asciiquarium:latest
```

`-it`는 `-i`, `-t` 를 동시에 사용한 옵션으로 사용자와 컨테이너 간에 인터렉션(interaction)이 필요하다면 이 옵션을 사용한다.

- 컨테이너 내부에서 명령어를 사용할 때

```
docker exec -it 컨테이너_이름 bash
```

이 명령어로 컨테이너 내부에 접속하여 명령어를 사용할 수 있다.

### 컨테이너에 파일 복사하기

로컬과 컨테이너를 연결하는 방법은 두가지가 있다.

- CP(Copy) : 호스트와 컨테이너 사이에 파일을 복사(Copy)

  Copy는 로컬에 있는 파일을 컨테이너에 그대로 복사할 때 사용한다. 로컬에 파일이 위치한 폴더 경로에서 터미널을 열어 아래와 같이 입력한다. 컨테이너는 httpd라는 이미지를 실행중인 상태이다. httpd(http daemon)은 Apache HTTP Server를 실행할 수 있는 오픈소스 웹 서버 소프트웨어이다.

  ```
  docker container cp ./ 컨테이너_이름:/usr/local/apache2/htdocs/
  ```

- Volume : 호스트와 컨테이너 사이에 공간을 마운트(Mount)

  Volume은 로컬과 컨테이너를 연결하는 것을 말한다. 컨테이너에 저장된 데이터는 컨테이너가 종료되면 삭제 된다. 이 경우 로컬 호스트 또는 다른 컴퓨터에 컨테이너 데이터를 연결에 따로 보관하는 것이 필요하다. 이때 Volume 을 사용한다.

- 컨테이너 포트 연결 및 실행

```
docker container run --name 컨테이너_이름 -p 818:80 httpd
```

httpd 이미지를 실행시키는 명령어로 -p 옵션은 포트를 지정할 때 사용한다. 818포트가 로컬 포트번호이고 80포트는 컨테이너 내부 포트를 의미한다.

### 도커 이미지 생성하기

- 빌드를 위해 [Dockerfile](https://docs.docker.com/engine/reference/builder/)을 생성한다.
- 이미지 빌드하기

```
docker build 이미지_이름 .
docker build --tag 이미지_이름:버전 .
```

- 실행중인 컨테이너, 이미지로 만들기

```
docker container commit 컨테이너_이름 이미지_이름
```

### 두개 이상의 도커 이미지 다루는 법(Docker-compose)

- 동시에 실행할 이미지를 모두 pull 한다.
- 원하는 로컬 경로에 `docker-compose.yaml`파일을 생성한다. `docker-compose.yaml`은 동시에 실행할 이미지들에 대한 적어놓은 파일이다.
- yaml 파일이 있는 경로에 명령어를 실행시킨다.

```
docker-compose up
docker-compose up -d
```

`-d` 명령어를 사용하면 백그라운드에 실행할 수 있다.(터미널이 종료되어도 계속 실행 상태로 둘 수 있다.)

- docker-compose로 실행시킨 컨테이너들을 종료시키고 싶다면 다음의 명령어를 사용한다.

```
docker-compose down
```
