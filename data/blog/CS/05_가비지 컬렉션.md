---
title: CS_가비지 컬렉션
date: '2021-09-19'
tags: ['CS']
draft: false
summary: 가비지 컬렉터란?
---

## 가비지 컬렉션이란?

> 프로그램에서 더이상 사용하지 않는 메모리를 자동으로 정리하는 것이다. 다른 말로 하면 참조 없는 객체들이 사용하는 메모리를 비워서 새로운 객체를 생성하기 위한 공간을 만드는 것이다. 참조 없는 객체(orphan object)란, 스택으로부터 (다른 객체 내부의 참조를 통해) 더 이상 직접 혹은 간접적으로 참조되지 않는 객체를 말한다.

C나 C++ 같은 언어는 메모리 누수를 막기 위해 일일히 개발자가 메모리를 비워줘야 했지만 자바나 파이썬, 자바스크립트 언어에서는 가비지 컬렉터를 이용해 자동으로 메모리 관리가 가능하다. 이렇게 메모리를 자동으로 관리해주는 언어를 `Managed Language`라고 하고 그렇지 않은 언어들을 `Unmanaged Language`라고 한다.

가비지 컬렉션은 작동방식을 이해하기 위해선 먼저, stack과 Heap에 대해 이해해야 한다.

## Stack 과 Heap

- stack : 정적으로 할당한 메모리 영역, 원시 타입의 데이터가 값과 함께 할당, Heap영역에 생성된 Object 타입 데이터의 참조 값을 할당한다.

- heap : 동적으로 할당한 메모리 영역, 모든 object타입의 데이터가 할당, Heap 영역의 object를 가리키는 참조 변수가 stack 에 할당된다.

예를 들어 아래와 같은 자바스크립트 코드가 있다고 하자.

```js
let num1 = 1
let num2 = 2
let arr = [1, 2]
```

이 코드가 실행되면 스택과 힙 메모리는 이렇게 쌓인다.

| stack    | heap  |
| -------- | ----- |
| num1 = 1 | -     |
| num2 = 2 | -     |
| arr      | [1,2] |

코드 실행이 마무리 되면 stack에 데이터는 날아가고 heap에 있는 데이터만 남게 되는데 이때 heap에 남아있는 배열 [1,2]는 더이상 자신을 가리키는 참조 변수가 stack에 없으므로 가비지 컬렉팅의 대상이 된다. 이런 객체를 `Unreachable Object`라고 한다.

## 대표적인 가비지 컬렉션 방법

- Reference Counting

  한 객체를 참조하는 변수의 수를 추적하는 방법. 객체를 참조하고 있던 변수의 값이 바뀌거나 변수 스코프를 벗어나면 레퍼런스 카운트가 줄어든다. 레퍼런스 카운트가 0이 되면, 그 객체와 관련한 메모리는 비울 수 있다. 그러나 이 경우 순환 참조하는 객체의 경우 절대 0이 될 수 없었기 때문에 이러한 객체는 감지할 수 없다는 단점이 있다.

- Mark and Sweep

  레퍼런스 카운팅의 문제점을 보완한다. 사이클마다 메모리 관리자가 root에서 부터 시작해 모든 객체를 추적해서 사용중인지 아닌지를 표시하고 표시되지 않은 객체를 삭제하는 방법. 2012년 기준 모든 브라우저는 가비지 컬렉션에 mark and sweep 방식을 사용하고 있다.

> 가비지 컬렉터는 언어와 환경마다 다른 방식으로 존재한다. 또한 가비지 컬렉터로 메모리 누수를 완벽하게 방지할 수 없다. 따라서 각 언어별로 가비지 컬렉터가 감지하지 못한 메모리 누수를 어떻게 보완할 수 있을지 개발자 스스로 공부해야한다.

## 자바스크립트의 가비지 컬렉터

가비지 컬렉션의 동작 방식은 브라우저의 자바스크립트 엔진에 따라 모두 상이하지만 2012년 기준 모든 최신 브라우저들은 `mark and sweep` 방식으로 작동한다.

자바스크립트에서는 명시적으로 또는 프로그래밍 방식으로 가비지 컬렉션을 작동할 수 없다.

## 참조

- [[10분 테코톡] 👌던의 JVM의 Garbage Collector](https://www.youtube.com/watch?v=vZRmCbl871I)
- [가비지 컬렉터가 뭐하는 건가요? (Feat. 메모리 관리)](https://www.youtube.com/watch?v=24f2-eJAeII)
