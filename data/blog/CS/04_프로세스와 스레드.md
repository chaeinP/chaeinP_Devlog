---
title: CS_프로세스와 스레드
date: '2021-09-12'
tags: ['CS']
draft: false
summary: 단일 코어에서도 멀티 스레드가 유리할까?
---

### 용어 정리

- 프로그램 : 작업을 위해서 실행할 수 있는 파일
- 프로세스 : 실행되고 있는 프로그램
- 스레드 : 프로세스 안에서 진행되는 실행 단위

## 프로그램이 실행되면 무슨일이 일어날까?

- 프로그램이 실행되면 OS는 해당 프로그램에게 메모리 자원을 할당한다.
- 이 때 프로세스가 생성되는데 이 프로세스는 다음과 같이 구성되어있다.

| 구성 요소 | 기능                                             |
| --------- | ------------------------------------------------ |
| Code      | 실행 명령을 포함하는 코드들                      |
| Data      | Static 변수 혹은 Global 변수                     |
| Heap      | 동적 메모리 영역                                 |
| Stack     | 지역변수, 매개변수, 반환 값 등등 일시적인 데이터 |

이와 더불어 해당 프로세스의 작업 정보를 저장하는 PCB(Process Control Block) 블럭이 생성된다.

![PCB](https://blog.kakaocdn.net/dn/q9Cda/btqEmwMRN34/a2nMadVTcblerkGk5yBfK0/img.png)

- CPU의 코어는 한 번에 하나의 프로세스만 처리할 수 있다. 우리가 컴퓨터를 통해 다양한 프로그램을 동시에 실행시킬 수 있다고 느끼는 것은 CPU의 동시성(Concurrency) 때문이다.

  💡 **CPU의 동시성(Concurrency)이란?**

  여러개의 프로세스를 동시에 실행시키기 위해 시분할로, 짧은 텀을 두고 여러 프로세스를 번갈아가며 실행시키는 것을 의미한다. 이렇게 번갈아가며 실행 프로세스가 전환되는 것을 **Context Switching** 이라고 한다. 위에서 언급한 PCB는 이 과정에서 각 프로세스의 전환 맥락(작업 정보)를 저장하는 역할을 수행한다.

  💡**Context Switching**

  CPU를 프로세스에서 프로세스로 또는 프로세스에서 스레드로 또는 스레드에서 스레드로 전환하는 것을 의미한다.

## 프로세스의 Context Switching

프로세스는 Context Switching에 있어 다음과 같은 특징을 갖는다.

- (+) 독립적으로 수행되어 다른 프로세스의 실행에 영향을 미치지 않는다.

  예를 들어 크롬 브라우저의 탭은 프로세스 단위로 실행된다. 하나의 탭에서 문제가 발생해도 다른 탭에 영향을 주지 않는다.

- (-) 캐싱 적중률이 떨어져 큰 전환 비용이 발생한다.

  💡 _캐싱 적중률이란?_

  자주 쓰는 혹은 자주 쓰일 것이라고 예상되는 데이터는 그 데이터의 복사본을 캐시 메모리에 저장해 사용하는 것이 효율적이다. 그러나 각 프로세스는 메모리를 공유하지 않기 때문에 Context Switching이 발생할 때마다 캐싱 데이터를 사용할 수 있는 확률이 줄어든다.

프로세스 Context Switching의 단점을 보완한 것이 스레드이다.

## 스레드의 Context Switching

스레드는 경량화된 프로세스로 볼 수 있다. 스레드는 프로세스 내부에 생성되는데 하나의 프로세스는 한 개이상의 스레드를 가질 수 있다.

- (+) 공유되는 자원을 사용하기 때문에 캐싱 적중률이 높다.
  스레드는 각각의 stack을 갖고 있지만 프로세스의 Code, Data, Heap 영역을 공유하기 때문이다.

- (-) 하나의 스레드는 다른 스레드에 영향을 미친다.
  예를 들어 과거 인터넷 익스플로어 브라우저의 경우 탭은 스레드 단위로 실행되었다. 이 때 하나의 탭에서 문제가 생기면 모든 탭에 영향을 미쳐 브라우저 전체가 종료돼버리는 경우가 종종 발생했다.

## 멀티 프로세스와 멀티 스레드

> 멀티스레드와 멀티프로세스는 CPU의 최대활용을 위해 프로그램의 둘 이상의 부분을 동시에(병렬적으로) 실행하는 기술이다. 빠르게 순차적으로 처리하는 CPU의 동시성과 혼동해선 안된다.

여기서 설명하고자하는 멀티 프로세스과 멀티 스레드은 단순히 여러개 프로그램의 프로세스, 여러개의 스레드가 실행되고 있는 것을 의미하는 것이 아니며 멀티 프로세스과 멀티 스레드 모두 하나의 애플리케이션을 실행할 때의 처리방식을 의미한다.

멀티 프로세스와 멀티 스레드은 싱글 코어 환경에서는 좋은 성능을 기대할 수 없다. 앞서 말했다시피 하나의 코어는 단 하나의 프로세스 또는 단 하나의 스레드만 실행할 수 있다. 따라서 멀티 프로세스과 멀티 스레드은 최소 두개 이상의 코어를 가진 환경에서 제대로 작동한다.

### 멀티 프로세스

멀티 프로세스의 예는 다음과 같다. 만약 여러명의 사용자가 거의 동일한 시간대에 로그인을 요청한다고 하면 멀티 프로세스가 구현된 어플리케이션은 로그인을 처리하는 부모 프로세스를 복사해 여러개의 프로세스로 분리한다. 이렇게 분리된 프로세스는 독립적으로 작동하며 독립된 메모리를 갖는다. 이렇게 분리된 프로세스는 각각의 로그인 작업을 할당받아 해당 작업을 동시에 처리한다.

멀티 프로세스의 특징은 다음과 같다.

- 각 프로세스는 독립적이다.
- 프로세스간 동기화 작업이 필요하지 않다. (드물게 자원을 공유하는 경우에는 동기화가 필요하다.)
- 프로세스간 자원을 공유하기 위해선 IPC 통신이 필요하다. 대표적인 IPC 통신으로는 webSocket이 있다.
- 각각 개별 메모리를 차지 한다는 점에서 자원 소모적이다.
- 전환 비용이 크다.

### 멀티 스레드

멀티 스레드은 예는 다음과 같다. 만약 VScode로 코드를 작성할 때 코드를 작성하는 동시에 Prettier가 코드를 수정하고 동시에 개발 서버를 실행할 수도 있다. 이렇게 하나의 애플리케이션을 스레드 단위로 나누어 실행시키는 것을 멀티 스레드라고 한다.

- 스레드끼리 긴밀하게 연결되어 있다.
- 자원을 공유하고 있어 통신 비용이 절감된다.
- 자원을 공유하고 있어 메모리 사용이 효율적이다.
- 전환 비용이 적다. 캐시 메모리는 그대로, PCB만 갈아끼워진다.
- 공유 자원의 동기화가 필요하다.(디버깅이 까다로워진다.)
- 싱글 코어 환경에서 멀티 스레드는 싱글 스레드 보다 오히려 성능이 안좋을 수도 있다. 싱글 스레드에는 발생하지 않는 Context Switching으로 전환 비용이 발생하기 때문이다.
- 그러나 I/O bound인 앱의 경우에는 싱글 코어에서도 멀티 스레드가 이점을 가질 수 있다. 사용자의 입력을 기다리는 상황에서 다른 스레드가 실행될 수 있기 때문이다. 이때 문맥 교환 비용이 사용자의 액션에 따른 입출력을 기다리기만 하는 비용보다 적을 수 있다.

### 프로세스와 스레드의 이해 높이기

- 프로세스와 스레드는 완전히 별개로 분리되지 않는다. 프로세스가 스레드를 포함하고 있기 때문이다.
- 프로세스가 동작한다는 것은 프로세스 내의 특정 스레드가 실행 중이라는 말과 같다. 그 특정 스레드는 프로세스가 가진 데이터를 참조한다.
- OS는 메모리 자원을 프로세스 단위로 할당한다.
- 작업이나 실행은 스레드 단위로 진행된다.

참조

- [[10분 테코톡] 🌷 코다의 Process vs Thread](https://www.youtube.com/watch?v=1grtWKqTn50)
- [[10분 테코톡] 👩‍💻👨‍💻 쪼밀리와 오구의 Process vs Thread
  ](https://www.youtube.com/watch?v=DmZnOg5Ced8&t=639s)
- [싱글 코어 환경에서 멀티스레드가 갖는 이점 - 스택오버플로우](https://stackoverflow.com/questions/20476638/single-vs-multi-threaded-programming-on-a-single-core-processor)
- [멀티 프로세싱과 멀티 스레딩](https://jeunjeun.tistory.com/6)
